
<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>bananaGPT — rule-based чат-бот</title>
    <style>
        :root {
            --bg: #0f1724;
            --text: #ffffff;
            --bubble-user: #2563eb;
            --bubble-bot: #374151;
            --header-bg: #1e293b;
            --input-bg: #1e293b;
            --border: #334155;
        }

        body.light {
            --bg: #f9fafb;
            --text: #000000;
            --bubble-user: #60a5fa;
            --bubble-bot: #e5e7eb;
            --header-bg: #e5e7eb;
            --input-bg: #f3f4f6;
            --border: #d1d5db;
        }

        body {
            margin: 0;
            font-family: system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        header {
            background: var(--header-bg);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

            .brand .logo {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                background: #facc15;
                font-size: 22px;
                box-shadow: 0 2px 6px rgba(0,0,0,0.25);
            }

        #controls {
            display: flex;
            gap: 8px;
        }

        .theme-btn {
            border: none;
            background: transparent;
            font-size: 18px;
            cursor: pointer;
        }

        #chat {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .msg {
            max-width: 70%;
            padding: 10px 14px;
            border-radius: 12px;
            line-height: 1.4;
            white-space: pre-wrap;
        }

        .user {
            align-self: flex-end;
            background: var(--bubble-user);
            color: #fff;
        }

        .bot {
            align-self: flex-start;
            background: var(--bubble-bot);
            color: var(--text);
        }

        #inputBar {
            display: flex;
            border-top: 1px solid var(--border);
            background: var(--input-bg);
            padding: 10px;
            gap: 10px;
        }

        #msgInput {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text);
        }

        #sendBtn {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: #22c55e;
            color: #fff;
            cursor: pointer;
        }

        #adminPanel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%,-50%);
            background: var(--bg);
            color: var(--text);
            border: 1px solid var(--border);
            padding: 20px;
            display: none;
            flex-direction: column;
            gap: 10px;
            width: 350px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
            z-index: 100;
        }

            #adminPanel input, #adminPanel textarea {
                width: 100%;
                padding: 8px;
                border-radius: 6px;
                border: 1px solid var(--border);
                background: var(--input-bg);
                color: var(--text);
            }

            #adminPanel button {
                padding: 8px;
                border: none;
                border-radius: 6px;
                background: #3b82f6;
                color: #fff;
                cursor: pointer;
            }

            #adminPanel hr {
                border: 0;
                border-top: 1px solid var(--border);
                margin: 10px 0;
            }
    </style>
</head>
<body>
    <header>
        <div class="brand">
            <div class="logo">🍌</div>
            <div>
                <div>bananaGPT</div>
                <div style="font-size:12px;opacity:0.6">Rule-based in-browser assistant</div>
            </div>
        </div>
        <div id="controls">
            <button id="adminBtn">Админ</button>
            <button id="themeBtn" class="theme-btn" title="Переключить тему">🌙</button>
        </div>
    </header>

    <div id="chat"></div>

    <div id="inputBar">
        <input id="msgInput" placeholder="Напишите сообщение..." />
        <button id="sendBtn">Отправить</button>
    </div>

    <div id="adminPanel">
        <h3>Добавить правило</h3>
        <input id="keywordInput" placeholder="Ключевое слово" />
        <textarea id="responseInput" placeholder="Ответ"></textarea>
        <button id="saveRuleBtn">Сохранить</button>
        <hr>
        <h3>API ключ погоды</h3>
        <input id="weatherKeyInput" placeholder="Введите OpenWeather API ключ" />
        <button id="saveWeatherKeyBtn">Сохранить ключ</button>
        <hr>
        <button id="clearChatBtn" style="background:#ef4444;">Очистить чат</button>
        <button id="closeAdminBtn">Закрыть</button>
    </div>

    <script>const chat = document.getElementById("chat");
        const msgInput = document.getElementById("msgInput");
        const sendBtn = document.getElementById("sendBtn");
        const adminBtn = document.getElementById("adminBtn");
        const adminPanel = document.getElementById("adminPanel");
        const saveRuleBtn = document.getElementById("saveRuleBtn");
        const closeAdminBtn = document.getElementById("closeAdminBtn");
        const keywordInput = document.getElementById("keywordInput");
        const responseInput = document.getElementById("responseInput");
        const themeBtn = document.getElementById("themeBtn");
        const weatherKeyInput = document.getElementById("weatherKeyInput");
        const saveWeatherKeyBtn = document.getElementById("saveWeatherKeyBtn");
        const clearChatBtn = document.getElementById("clearChatBtn");

        // Загрузка шаблонов и истории
        let rules = JSON.parse(localStorage.getItem("rules") || "[]");
        let history = JSON.parse(localStorage.getItem("history") || "[]");
        history.forEach(m => addMsg(m.text, m.sender, false));

        // Банановые шутки
        const jokes = [ /* 50 шуток */];

        // Полные банановые рецепты с инструкциями
        const recipes = [
            `Банановый хлеб
Ингредиенты:
- 3 спелых банана
- 150 г сахара
- 1 яйцо
- 200 г муки
- 1 ч.л. разрыхлителя
- щепотка соли
Приготовление:
1. Разогреть духовку до 180°С.
2. Размять бананы в пюре.
3. Добавить сахар и яйцо, перемешать.
4. Просеять муку с разрыхлителем и солью, добавить к бананам.
5. Выложить в смазанную форму.
6. Выпекать 45 минут, проверить готовность зубочисткой.`,

            `Банановые маффины
Ингредиенты:
- 2 банана
- 100 г сахара
- 1 яйцо
- 100 г муки
- 50 мл молока
- 1 ч.л. разрыхлителя
Приготовление:
1. Разогреть духовку до 180°С.
2. Размять бананы и смешать с яйцом и сахаром.
3. Добавить муку, молоко и разрыхлитель, перемешать.
4. Разложить по формочкам.
5. Выпекать 20 минут.`,

            `Банановый кекс с шоколадом
Ингредиенты:
- 2 банана
- 80 г сахара
- 1 яйцо
- 120 г муки
- 50 г шоколадных капель
- 1 ч.л. разрыхлителя
Приготовление:
1. Разогреть духовку до 180°С.
2. Размять бананы, смешать с яйцом и сахаром.
3. Добавить муку, разрыхлитель и шоколадные капли.
4. Выложить в форму и выпекать 35 минут.`,

            `Банановый пудинг
Ингредиенты:
- 3 банана
- 500 мл молока
- 3 ст.л. сахара
- 2 ст.л. кукурузного крахмала
Приготовление:
1. Разогреть молоко с сахаром.
2. Добавить крахмал, варить до загустения.
3. Добавить бананы и перемешать.`,

            `Бананово-овсяные печенья
Ингредиенты:
- 2 банана
- 100 г овсяных хлопьев
- 1 ч.л. корицы
Приготовление:
1. Размять бананы и смешать с овсянкой и корицей.
2. Выложить на противень.
3. Выпекать 15 минут при 180°С.`,

            `Банановый чизкейк
Ингредиенты:
- 3 банана
- 200 г творога
- 2 яйца
- 50 г сахара
- 50 г печенья
Приготовление:
1. Размять бананы.
2. Смешать с творогом, яйцами и сахаром.
3. Выложить на измельченное печенье.
4. Выпекать 35 минут при 170°С.`,

            `Бананово-кокосовый кекс
Ингредиенты:
- 2 банана
- 100 г кокосовой стружки
- 100 г муки
- 80 г сахара
- 1 яйцо
Приготовление:
1. Разогреть духовку до 180°С.
2. Смешать все ингредиенты.
3. Выложить в форму и выпекать 30 минут.`,

            `Бананово-шоколадные брауни
Ингредиенты:
- 2 банана
- 50 г какао
- 100 г муки
- 80 г сахара
- 1 яйцо
Приготовление:
1. Разогреть духовку до 180°С.
2. Смешать бананы с яйцом и сахаром.
3. Добавить муку и какао.
4. Выпекать 25 минут.`,

            `Банановый пирог с орехами
Ингредиенты:
- 3 банана
- 150 г муки
- 100 г сахара
- 50 г орехов
- 1 яйцо
- 1 ч.л. разрыхлителя
Приготовление:
1. Разогреть духовку до 180°С.
2. Смешать все ингредиенты.
3. Выпекать 40 минут.`,

            `Бананово-яблочные кексы
Ингредиенты:
- 2 банана
- 1 яблоко
- 120 г муки
- 80 г сахара
- 1 яйцо
Приготовление:
1. Разогреть духовку до 180°С.
2. Размять бананы и нарезать яблоко.
3. Смешать с остальными ингредиентами.
4. Выпекать 20 минут.`,

            `Банановый смузи-кекс
Ингредиенты:
- 2 банана
- 100 г муки
- 50 г сахара
- 50 мл молока
- 1 яйцо
Приготовление:
1. Разогреть духовку до 180°С.
2. Размять бананы и смешать с яйцом и сахаром.
3. Добавить муку и молоко.
4. Выложить в форму и выпекать 25 минут.`,

            `Банановый пирог с карамелью
Ингредиенты:
- 2 банана
- 120 г муки
- 80 г сахара
- 50 г сливочного масла
Приготовление:
1. Разогреть духовку до 180°С.
2. Растопить масло и смешать с сахаром.
3. Добавить бананы и муку.
4. Выложить в форму и выпекать 30 минут.`,

            `Бананово-медовые печенья
Ингредиенты:
- 2 банана
- 2 ст.л. мёда
- 100 г овсянки
Приготовление:
1. Размять бананы и смешать с мёдом.
2. Добавить овсянку, сформировать печенья.
3. Выпекать 15 минут при 180°С.`,

            `Банановый ролл с корицей
Ингредиенты:
- 2 банана
- 100 г муки
- 50 г сахара
- 1 ч.л. корицы
- 1 яйцо
Приготовление:
1. Разогреть духовку до 180°С.
2. Размять бананы и смешать с яйцом и сахаром.
3. Добавить муку и корицу, замесить тесто.
4. Сформировать рулет и выпекать 20 минут.`,

            `Банановый пудинг с шоколадом
Ингредиенты:
- 3 банана
- 400 мл молока
- 3 ст.л. сахара
- 2 ст.л. кукурузного крахмала
- 50 г шоколада
Приготовление:
1. Варить молоко с сахаром.
2. Добавить крахмал и шоколад, варить до загустения.
3. Добавить нарезанные бананы и перемешать.`,

            `Банановый пирог с йогуртом
Ингредиенты:
- 2 банана
- 100 г муки
- 50 г сахара
- 1 яйцо
- 50 мл йогурта
Приготовление:
1. Разогреть духовку до 180°С.
2. Смешать бананы, яйцо и сахар.
3. Добавить муку и йогурт.
4. Выпекать 25 минут.`,

            `Банановый пудинг с корицей
Ингредиенты:
- 2 банана
- 250 мл молока
- 2 ст.л. сахара
- 1 ч.л. корицы
- 1 ст.л. муки
Приготовление:
1. Варить молоко с сахаром и мукой до загустения.
2. Добавить бананы и корицу.`,

            `Банановый кекс с изюмом
Ингредиенты:
- 2 банана
- 80 г сахара
- 1 яйцо
- 100 г муки
- 50 г изюма
Приготовление:
1. Разогреть духовку до 180°С.
2. Смешать бананы, яйцо и сахар.
3. Добавить муку и изюм.
4. Выпекать 30 минут.`,

            `Бананово-тыквенные маффины
Ингредиенты:
- 2 банана
- 100 г тыквенного пюре
- 80 г сахара
- 100 г муки
- 1 яйцо
Приготовление:
1. Разогреть духовку до 180°С.
2. Смешать бананы с тыквенным пюре, яйцом и сахаром.
3. Добавить муку и выпекать 20 минут.`,

            `Банановый брауни с орехами
Ингредиенты:
- 2 банана
- 50 г какао
- 100 г муки
- 50 г орехов
- 80 г сахара
- 1 яйцо
Приготовление:
1. Разогреть духовку до 180°С.
2. Смешать бананы, яйцо и сахар.
3. Добавить муку, какао и орехи.
4. Выпекать 25 минут.`,

            `Бананово-кокосовые печенья
Ингредиенты:
- 2 банана
- 50 г кокосовой стружки
- 80 г овсянки
- 1 ст.л. мёда
Приготовление:
1. Размять бананы и смешать с остальными ингредиентами.
2. Сформировать печенья и выпекать 15 минут.`,

            `Банановый штрудель
Ингредиенты:
- 2 банана
- 100 г муки
- 50 г сахара
- 1 ч.л. корицы
- 1 яйцо
Приготовление:
1. Замесить тесто, раскатать.
2. Нарезать бананы, смешать с сахаром и корицей.
3. Свернуть рулетом и выпекать 25 минут.`,

            `Бананово-ягодный пирог
Ингредиенты:
- 2 банана
- 100 г ягод (черника, малина)
- 100 г муки
- 50 г сахара
- 1 яйцо
Приготовление:
1. Разогреть духовку до 180°С.
2. Смешать бананы, яйцо и сахар.
3. Добавить муку и ягоды.
4. Выпекать 25-30 минут.`
        ];

        // Функция добавления сообщений
        function addMsg(text, sender, save = true) {
            const div = document.createElement("div");
            div.className = "msg " + sender;
            div.textContent = text;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
            if (save) { history.push({ text, sender }); localStorage.setItem("history", JSON.stringify(history)); }
        }

        // Функция ответа бота
        function botReply(userText) {
            const lower = userText.toLowerCase();
            if (lower.includes("шутк")) { addMsg(jokes[Math.floor(Math.random() * jokes.length)], "bot"); return; }
            if (lower.includes("рецепт") || lower.includes("выпечка") || lower.includes("банановая")) {
                addMsg(recipes[Math.floor(Math.random() * recipes.length)], "bot"); return;
            }
            if (lower.includes("погода")) { const city = lower.split("погода")[1]?.trim() || "Moscow"; getWeather(city); return; }

            for (const rule of rules) { if (lower.includes(rule.keyword.toLowerCase())) { addMsg(rule.response, "bot"); return; } }
            if (lower.includes("привет")) return addMsg("Привет! Я bananaGPT 🍌", "bot");
            if (lower.includes("математика") || lower.match(/[0-9+\-*/=]/)) { try { addMsg("Ответ: " + eval(userText), "bot"); } catch { addMsg("Не понял задачу.", "bot"); } return; }
            addMsg("Интересно... Расскажи подробнее!", "bot");
        }

        // Погода
        async function getWeather(city) {
            const apiKey = localStorage.getItem("weatherKey") || "";
            if (!apiKey) { addMsg("Сначала добавьте API ключ OpenWeatherMap в админ-панели.", "bot"); return; }
            try {
                const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&units=metric&lang=ru&appid=${apiKey}`);
                const data = await res.json();
                if (data.cod == 200) { addMsg(`Погода в ${city}: ${data.main.temp}°C, ${data.weather[0].description}`, "bot"); }
                else { addMsg("Не удалось найти погоду для города: " + city, "bot"); }
            } catch (err) { addMsg("Ошибка запроса погоды.", "bot"); }
        }

        // Кнопки и события
        sendBtn.onclick = () => { const t = msgInput.value.trim(); if (!t) return; addMsg(t, "user"); botReply(t); msgInput.value = ""; };
        adminBtn.onclick = () => { adminPanel.style.display = "flex"; };
        closeAdminBtn.onclick = () => { adminPanel.style.display = "none"; };
        saveRuleBtn.onclick = () => { if (keywordInput.value && responseInput.value) { rules.push({ keyword: keywordInput.value, response: responseInput.value }); localStorage.setItem("rules", JSON.stringify(rules)); addMsg("Новое правило сохранено.", "bot"); keywordInput.value = ""; responseInput.value = ""; } };
        saveWeatherKeyBtn.onclick = () => { if (weatherKeyInput.value) { localStorage.setItem("weatherKey", weatherKeyInput.value.trim()); addMsg("API ключ сохранён.", "bot"); weatherKeyInput.value = ""; } };
        clearChatBtn.onclick = () => { history = []; localStorage.removeItem("history"); chat.innerHTML = ""; addMsg("Чат очищен.", "bot"); };

        // Тема
        function setTheme(theme) { if (theme === "light") { document.body.classList.add("light"); themeBtn.textContent = "☀️"; } else { document.body.classList.remove("light"); themeBtn.textContent = "🌙"; } localStorage.setItem("theme", theme); }
        themeBtn.onclick = () => { const current = document.body.classList.contains("light") ? "light" : "dark"; setTheme(current === "light" ? "dark" : "light"); };
        setTheme(localStorage.getItem("theme") || "dark");</script>
</body>
</html>
